name: Auto Deploy
on:
 push:
  branches:[master]
jobs:
 build-and-test:
  runs-on: ubuntu-latest
  steps:
   - uses: actions/checkout@v2
   - name: Setup Node.js
     uses: actions/setup-node@v1
     with:
	node-version: '12'
   - uses: actions/cache@v2
     with:
	path: ~/.npm
	key: ${{ runner.os }}-node-${{ hashFiles('**/package-lock.json')}}
	restore-keys: ${{} runner.os}-node-
   - run: npm ci
   - run: npm run build --if-present
   - run: npm run test:unit
   - uses: netlify/actions/cli@master
     env:
	NETLIFY_AUTH_TOKEN: ${{ secret.NETLIFY_AUTH_TOKEN }}
	NETLIFY_SITE_ID: ${{ secret.NETLIFY_SITE_ID }}
     with:
	args: deploy --dir=dist --prod
	secrets: '["NETLIFY_AUTH_TOKEN", "NETLIFY_SITE_ID"]'

